<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Birthday Letter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;700&family=Satisfy&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="page-transitions.css" />
    <link rel="icon" href="images/logo/bday logo.png" type="image/png" />
    <link rel="apple-touch-icon" href="images/logo/bday logo.png" />
    <link rel="shortcut icon" href="images/logo/bday logo.png" type="image/png" />
    <style>
      .letter-page { position: fixed; inset: 0; display: grid; place-items: center; padding: 24px; text-align: center; }
      .letter-header { text-align: center; padding: 16px 20px; }
      .letter-header h1 { font-family: 'Satisfy', cursive; color: var(--text); margin: 0; }
      .back-btn { position: absolute; left: 16px; top: 12px; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; color: var(--text); background: var(--mint-200); border-radius: 999px; padding: 8px 14px; border: 1px solid rgba(0,0,0,0.06); }
      .back-btn .arrow { font-size: 18px; line-height: 1; }
      .back-btn span { font-weight: 600; }
      .envelope { position: relative; width: clamp(320px, 80vw, 880px); height: clamp(240px, 56vw, 560px); border-radius: 16px; background: #ffffff; box-shadow: 0 10px 30px rgba(0,0,0,0.15); overflow: hidden; --flap-depth: 64%; }
      .flap { position: absolute; inset: 0; background: linear-gradient(135deg, #8bd1b2, #77c9a6); transform-origin: top; clip-path: polygon(0% 0%, 100% 0%, 50% var(--flap-depth)); }
      .flap::after { content: ""; position: absolute; left: 0; right: 0; top: var(--flap-depth); height: 2px; background: rgba(0,0,0,0.08); }
      .seal { position: absolute; left: 50%; top: var(--flap-depth); transform: translate(-50%, -50%); width: 80px; height: 80px; background: #79c7a8; border-radius: 50%; display: grid; place-items: center; box-shadow: 0 6px 18px rgba(0,0,0,0.12); pointer-events: none; }
      .seal::before { content: "❤"; color: #ffffff; font-size: 26px; line-height: 1; }
      .paper { position: absolute; left: 4%; right: 4%; top: 100%; height: 92%; background: #ffffff; border-radius: 14px; box-shadow: 0 10px 30px rgba(0,0,0,0.18); display: grid; place-items: start; padding: clamp(16px, 2vw, 24px); text-align: left; font-size: clamp(14px, 1.6vw, 18px); line-height: 1.6; overflow: auto; -ms-overflow-style: none; scrollbar-width: none; }
      .paper::-webkit-scrollbar { width: 0; height: 0; display: none; }
      .paper { --body-size: 16px; --paper-pad: 24px; --title-size: 34px; }
      .paper { padding: var(--paper-pad); font-size: var(--body-size); }
      .paper h1 { font-family: 'Satisfy', cursive; color: var(--text); margin: 4px 0 12px; font-size: var(--title-size); }
      .paper .content { width: 100%; }
      .paper p { color: var(--text); margin: 0 0 12px; }
      .to-caption { color: var(--text-soft); margin-top: 14px; }
    </style>
  </head>
  <body class="theme-mint page">
    <div id="hearts-layer" aria-hidden="true"></div>
    <main class="letter-page">
      <a class="back-btn" href="home.html" aria-label="Back to Home">
        <span class="arrow">←</span>
        <span>Back</span>
      </a>
      <header class="letter-header">
        <h1>To my baby...</h1>
      </header>
      <div>
        <div class="envelope" id="envelope" aria-label="Envelope">
          <div class="flap" id="flap"></div>
          <div class="seal" aria-hidden="true"></div>
          <div class="paper" id="paper">
            <div class="content">
              <h1>Dearest Angel Baive,</h1>
              <p>Happy birthday to the most amazing person in my world!</p>
              <p>From the moment you came into my life, every single day has felt brighter and more meaningful, all because of you.</p>
              <p>I love the way your eyes light up when you talk about the things you love, and the way your smile can turn even the simplest moment into something special. You inspire me every day just by being yourself.</p>
              <p>Today, I want you to remember how deeply you are loved and cherished. You truly deserve all the happiness this world can offer.</p>
              <p>Here’s to another year of adventures, laughter, and beautiful memories together. I’ll always be right here, loving you, supporting you, and cheering you on every step of the way.</p>
              <p>Happy Birthday, my pretty baby!</p>
              <p>Forever yours,</p>
              <p>Ana</p>
            </div>
          </div>
        </div>

      </div>
    </main>
    <script src="transition.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script>
      function createHearts(count = 20) {
        const layer = document.getElementById('hearts-layer');
        const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
        for (let i = 0; i < count; i++) {
          const h = document.createElement('div');
          h.className = 'heart';
          const size = 16 + Math.random() * 18;
          h.style.setProperty('--size', `${size}px`);
          h.style.left = `${Math.random() * vw}px`;
          h.style.top = `${60 + Math.random() * 30}vh`;
          h.style.opacity = `${0.55 + Math.random() * 0.35}`;
          h.style.setProperty('--dur', `${8 + Math.random() * 8}s`);
          layer.appendChild(h);
        }
      }
      createHearts(24);

      const flap = document.getElementById('flap');
      const paper = document.getElementById('paper');
      const envelope = document.getElementById('envelope');
      let opened = false;

      // Scale text and padding relative to envelope width
      function applyResponsiveTypography() {
        const baseW = 880; // design reference width
        const w = envelope.clientWidth || baseW;
        const scale = w / baseW;
        const bodyMin = 12, bodyMax = 20;
        const titleMin = 24, titleMax = 42;
        const padMin = 14, padMax = 28;
        const body = Math.max(bodyMin, Math.min(bodyMax, 16 * scale));
        const title = Math.max(titleMin, Math.min(titleMax, 34 * scale));
        const pad = Math.max(padMin, Math.min(padMax, 24 * scale));
        paper.style.setProperty('--body-size', `${body}px`);
        paper.style.setProperty('--title-size', `${title}px`);
        paper.style.setProperty('--paper-pad', `${pad}px`);
      }

      function recenterPaper() {
        const E = envelope.clientHeight;
        const P = paper.clientHeight;
        return ((E - P) / 2) - E; // from initial top: 100% of envelope
      }

      function openEnvelope() {
        if (opened) return;
        opened = true;
        gsap.to(flap, { rotateX: 180, duration: 0.7, ease: 'power2.inOut', transformOrigin: 'top' });
        gsap.to('.seal', { opacity: 0, scale: 0.85, duration: 0.4, ease: 'power2.out' });
        applyResponsiveTypography();
        const targetY = recenterPaper();
        gsap.to(paper, { y: targetY, duration: 1.0, ease: 'power2.out', delay: 0.2 });
      }

      function closeEnvelope() {
        if (!opened) return;
        gsap.to(paper, { y: 0, duration: 0.8, ease: 'power2.in', onComplete: () => {
          gsap.to(flap, { rotateX: 0, duration: 0.6, ease: 'power2.out', transformOrigin: 'top' });
          gsap.to('.seal', { opacity: 1, scale: 1, duration: 0.3, ease: 'power2.in' });
          opened = false;
        }});
      }

      envelope.addEventListener('click', openEnvelope);
      paper.addEventListener('click', (e) => { e.stopPropagation(); closeEnvelope(); });

      // Keep paper centered when viewport resizes while open
      function handleResize() {
        if (!opened) return;
        applyResponsiveTypography();
        const y = recenterPaper();
        gsap.set(paper, { y });
      }
      window.addEventListener('resize', handleResize);
      window.addEventListener('orientationchange', handleResize);

      // Keep content fit and centering updated during continuous resizes
      function handleResizeAll() {
        applyResponsiveTypography();
        if (opened) {
          const y = recenterPaper();
          gsap.set(paper, { y });
        } else {
          gsap.set(paper, { y: 0 });
        }
      }
      const ro = new ResizeObserver(handleResizeAll);
      ro.observe(envelope);
      ro.observe(paper);
      window.addEventListener('load', handleResizeAll);

      // Initialize responsive typography for closed state
      applyResponsiveTypography();
    </script>
  </body>
  </html>
